# 16S OTDN amplification analysis

## Description
Purpose of the work flow is to run analysis of 16S data generated by using the samole preparation kit based on OTDN technology

## Dependencies

* `miniconda3 `


This workflow has quite a lot of dependancies. The best way to handle them is to use cona.
please directly to the step 6 of the Workflow setup.

## Workflow setup

1. Install `conda`:
```bash
   wget -P miniconda https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh &&
   chmod 755 ./miniconda/Miniconda3-latest-Linux-x86_64.sh &&
   ./miniconda/Miniconda3-latest-Linux-x86_64.sh
```

2. Add path of `miniconda` to `.bashrc` if not selected option to add automatically during installation:
```bash
   cd ~/ && pth=$(pwd) &&
   echo "PATH=$PATH:$pth/miniconda3/bin" >> ~/.bashrc
```

3. Install mamba frontend for conda. This helps to handle dependancies installation.
```bash
    conda install -c conda-forge mamba
```

4. Create your `conda` environment:
 ```bash
    mamba env create -f envs/main.yaml -n 16s4otdn
 ```

5. Activate created environment:
```bash
    source activate 16s4otdn
```

6. Install and setup julia 1.5+, using comands like below :
```bash
    wget https://julialang-s3.julialang.org/bin/linux/x64/1.5/julia-1.5.2-linux-x86_64.tar.gz
    tar -xvzf julia-1.5.2-linux-x86_64.tar.gz
    sudo cp -r julia-1.5.2 /opt/
    sudo ln -s /opt/julia-1.5.2/bin/julia /usr/local/bin/julia
    rm julia-1.5.2-linux-x86_64.tar.gz
```
7. setup required julia environment :
```bash
   cd scripts/julia_modules/st16SseqJuliaTools
   ./setup.sh 
```

6. Run the small scale analysis and a set of tests:
The workflow will download small versions of several databases. In the example below 12 threads are allowed to use.
```bash
    cd testing
    ./run_tests.py  --threads 12
```

## Example analysis

* Run `snakemake` to extyract examplary raw files:
```bash
   #Presume that 12 threads are available (option -j 12). 
   #Prepare the example dataset:
    snakemake --use-conda --conda-frontend mamba --configfile testing/testing.yaml -j 12  extract_testing_file
```
* Run `snakemake` to perform analysis itself:
```bash
   #Presume that 12 threads are available (option -j 12)
   snakemake --configfile configs/example.yaml -j 12 --use-conda --conda-frontend mamba 
```

This would run an analysis on a small dataset matching simulated data matching Zymo standard (https://www.zymoresearch.com/collections/zymobiomics-microbial-community-standards/products/zymobiomics-microbial-community-dna-standard). 
To run analysis on a real dataset please create a configuration file following the `testing/testing.yaml` example and comments within this file.


