Building DAG of jobs...
Using shell: /bin/bash
Provided cores: 24
Rules claiming more threads will be scaled down.
Job counts:
	count	jobs
	1	agregate_count
	1	all
	1	assemble
	1	count_reads
	1	cp_read_counts
	1	custer
	1	detect_rRNA
	1	filter_primer_sequence_having_reads
	1	filter_size
	1	filterout_r1primer_sequence_having_reads
	1	filterout_r2primer_sequence_having_reads
	1	generate_script_for_merging_files
	1	get_fastq1
	1	get_fastq2
	1	match_pairs_after_filtering
	1	prefilter_primer_sequence_having_reads
	1	retrim_R2_adapters_from_primers
	1	subsample
	1	trim_adapters
	19

[Wed Aug  7 20:00:31 2019]
rule generate_script_for_merging_files:
    input: dependencies/slimfastq/slimfastq
    output: tmp_coli/ODN-E-coli-1_S1R1_input_list.sh, tmp_coli/ODN-E-coli-1_S1R2_input_list.sh
    jobid: 18
    wildcards: stem=ODN-E-coli-1_S1

[Wed Aug  7 20:00:31 2019]
Finished job 18.
1 of 19 steps (5%) done

[Wed Aug  7 20:00:31 2019]
rule get_fastq1:
    input: tmp_coli/ODN-E-coli-1_S1R1_input_list.sh
    output: tmp_coli/ODN-E-coli-1_S1_R1_001.fastq.gz
    jobid: 16
    wildcards: stem=ODN-E-coli-1_S1

./tmp_coli/ODN-E-coli-1_S1R1_input_list.sh > tmp_coli/ODN-E-coli-1_S1_R1_001.fastq.gz

[Wed Aug  7 20:00:31 2019]
rule get_fastq2:
    input: tmp_coli/ODN-E-coli-1_S1R2_input_list.sh
    output: tmp_coli/ODN-E-coli-1_S1_R2_001.fastq.gz
    jobid: 15
    wildcards: stem=ODN-E-coli-1_S1

./tmp_coli/ODN-E-coli-1_S1R2_input_list.sh > tmp_coli/ODN-E-coli-1_S1_R2_001.fastq.gz
[Wed Aug  7 20:01:01 2019]
Finished job 16.
2 of 19 steps (11%) done
[Wed Aug  7 20:01:04 2019]
Finished job 15.
3 of 19 steps (16%) done

[Wed Aug  7 20:01:04 2019]
rule trim_adapters:
    input: tmp_coli/ODN-E-coli-1_S1_R1_001.fastq.gz, tmp_coli/ODN-E-coli-1_S1_R2_001.fastq.gz
    output: output_coli/LOGS/BBDUK/ODN-E-coli-1_S1_contamination.log, tmp_coli/ODN-E-coli-1_S1_R1_001Trimmed.fastq.gz, tmp_coli/ODN-E-coli-1_S1_R2_001Trimmed.fastq.gz
    log: output_coli/LOGS/BBDUK/trimming_ODN-E-coli-1_S1.log
    jobid: 13
    benchmark: benchmarks/trimming_ODN-E-coli-1_S1.log
    wildcards: stem=ODN-E-coli-1_S1
    threads: 8

bbduk.sh in=tmp_coli/ODN-E-coli-1_S1_R1_001.fastq.gz out=tmp_coli/ODN-E-coli-1_S1_R1_001Trimmed.fastq.gz in2=tmp_coli/ODN-E-coli-1_S1_R2_001.fastq.gz out2=tmp_coli/ODN-E-coli-1_S1_R2_001Trimmed.fastq.gz ref=datasets/bbmap/two_short.fa threads=8 ktrim=r k=23 mink=11 hdist=1 minlength=100 maxns=1 qtrim=r trimq=15 tpe tbo threads=8 stats=output_coli/LOGS/BBDUK/ODN-E-coli-1_S1_contamination.log overwrite=t -Xmx4g 2> output_coli/LOGS/BBDUK/trimming_ODN-E-coli-1_S1.log
[Wed Aug  7 20:01:11 2019]
Finished job 13.
4 of 19 steps (21%) done

[Wed Aug  7 20:01:11 2019]
rule count_reads:
    input: tmp_coli/ODN-E-coli-1_S1_R1_001.fastq.gz, tmp_coli/ODN-E-coli-1_S1_R1_001Trimmed.fastq.gz
    output: tmp_coli/ODN-E-coli-1_S1_read_counts.txt
    jobid: 17
    benchmark: benchmarks/ODN-E-coli-1_S1_count_reads.log
    wildcards: stem=ODN-E-coli-1_S1

./scripts/fastq_num_reads.sh tmp_coli/ODN-E-coli-1_S1_R1_001.fastq.gz tmp_coli/ODN-E-coli-1_S1_R1_001Trimmed.fastq.gz > tmp_coli/ODN-E-coli-1_S1_read_counts.txt; sed -i -e 's/^/ODN-E-coli-1_S1 /' tmp_coli/ODN-E-coli-1_S1_read_counts.txt ; echo >>  tmp_coli/ODN-E-coli-1_S1_read_counts.txt
[Wed Aug  7 20:01:17 2019]
Finished job 17.
5 of 19 steps (26%) done

[Wed Aug  7 20:01:17 2019]
rule agregate_count:
    input: tmp_coli/ODN-E-coli-1_S1_read_counts.txt
    output: tmp_coli/read_counts.txt
    jobid: 14

cat tmp_coli/ODN-E-coli-1_S1_read_counts.txt > tmp_coli/read_counts.txt
[Wed Aug  7 20:01:17 2019]
Finished job 14.
6 of 19 steps (32%) done

[Wed Aug  7 20:01:17 2019]
rule cp_read_counts:
    input: tmp_coli/read_counts.txt
    output: output_coli/read_counts.txt
    jobid: 12

cp tmp_coli/read_counts.txt output_coli/read_counts.txt
[Wed Aug  7 20:01:17 2019]
Finished job 12.
7 of 19 steps (37%) done

[Wed Aug  7 20:01:17 2019]
rule subsample:
    input: tmp_coli/ODN-E-coli-1_S1_R1_001Trimmed.fastq.gz, tmp_coli/ODN-E-coli-1_S1_R2_001Trimmed.fastq.gz, output_coli/read_counts.txt
    output: tmp_coli/ODN-E-coli-1_S1_R1_001subs.fastq.gz, tmp_coli/ODN-E-coli-1_S1_R2_001subs.fastq.gz
    log: output_coli/LOGS/SEQTK/R1/ODN-E-coli-1_S1.log, output_coli/LOGS/SEQTK/R2/ODN-E-coli-1_S1.log
    jobid: 10
    benchmark: benchmarks/ODN-E-coli-1_S1_subsampling.log
    wildcards: stem=ODN-E-coli-1_S1
    threads: 4

minimum=`python ./scripts/get_minimum_read_number.py --input output_coli/read_counts.txt`;
            seqkit sample -s 11 -j 4 --two-pass -n $minimum             tmp_coli/ODN-E-coli-1_S1_R1_001Trimmed.fastq.gz -o tmp_coli/ODN-E-coli-1_S1_R1_001subs.fastq.gz 2> output_coli/LOGS/SEQTK/R1/ODN-E-coli-1_S1.log;
            seqkit sample -s 11 -j 4 --two-pass -n $minimum             tmp_coli/ODN-E-coli-1_S1_R2_001Trimmed.fastq.gz -o tmp_coli/ODN-E-coli-1_S1_R2_001subs.fastq.gz 2> output_coli/LOGS/SEQTK/R2/ODN-E-coli-1_S1.log;
[Wed Aug  7 20:01:37 2019]
Finished job 10.
8 of 19 steps (42%) done

[Wed Aug  7 20:01:37 2019]
rule prefilter_primer_sequence_having_reads:
    input: tmp_coli/ODN-E-coli-1_S1_R1_001subs.fastq.gz, tmp_coli/ODN-E-coli-1_S1_R2_001subs.fastq.gz
    output: output_coli/LOGS/BBDUK/ODN-E-coli-1_S1_prefilteringbasedonR1.log, tmp_coli/ODN-E-coli-1_S1_R1_001filteredpre.fastq.gz, tmp_coli/ODN-E-coli-1_S1_R2_001filteredpre.fastq.gz
    log: output_coli/LOGS/filteringR1_ODN-E-coli-1_S1.log
    jobid: 8
    benchmark: benchmarks/prefilteringR1_ODN-E-coli-1_S1.log
    wildcards: stem=ODN-E-coli-1_S1
    threads: 8

bbduk.sh in=tmp_coli/ODN-E-coli-1_S1_R1_001subs.fastq.gz outm=tmp_coli/ODN-E-coli-1_S1_R1_001filteredpre.fastq.gz in2=tmp_coli/ODN-E-coli-1_S1_R2_001subs.fastq.gz outm2=tmp_coli/ODN-E-coli-1_S1_R2_001filteredpre.fastq.gz ref=datasets/bbmap/R1_rev.fasta threads=8  k=15  threads=8 stats=output_coli/LOGS/BBDUK/ODN-E-coli-1_S1_prefilteringbasedonR1.log overwrite=t -Xmx4g 2> output_coli/LOGS/filteringR1_ODN-E-coli-1_S1.log
[Wed Aug  7 20:01:40 2019]
Finished job 8.
9 of 19 steps (47%) done

[Wed Aug  7 20:01:40 2019]
rule filter_primer_sequence_having_reads:
    input: tmp_coli/ODN-E-coli-1_S1_R1_001filteredpre.fastq.gz, tmp_coli/ODN-E-coli-1_S1_R2_001filteredpre.fastq.gz
    output: output_coli/LOGS/BBDUK/ODN-E-coli-1_S1_filteringbasedonR1R2primer.log, tmp_coli/ODN-E-coli-1_S1_R1_001filtered.fastq.gz, tmp_coli/ODN-E-coli-1_S1_R2_001filtered.fastq.gz
    log: output_coli/LOGS/filteringR1R2_ODN-E-coli-1_S1.log
    jobid: 6
    benchmark: benchmarks/filteringR1_ODN-E-coli-1_S1.log
    wildcards: stem=ODN-E-coli-1_S1
    threads: 8

bbduk.sh in=tmp_coli/ODN-E-coli-1_S1_R1_001filteredpre.fastq.gz out=tmp_coli/ODN-E-coli-1_S1_R1_001filtered.fastq.gz in2=tmp_coli/ODN-E-coli-1_S1_R2_001filteredpre.fastq.gz out2=tmp_coli/ODN-E-coli-1_S1_R2_001filtered.fastq.gz ref=datasets/bbmap/R1_for.fasta threads=8  k=15  threads=8 stats=output_coli/LOGS/BBDUK/ODN-E-coli-1_S1_filteringbasedonR1R2primer.log overwrite=t -Xmx4g 2> output_coli/LOGS/filteringR1R2_ODN-E-coli-1_S1.log
[Wed Aug  7 20:01:42 2019]
Finished job 6.
10 of 19 steps (53%) done

[Wed Aug  7 20:01:42 2019]
rule filterout_r2primer_sequence_having_reads:
    input: tmp_coli/ODN-E-coli-1_S1_R2_001filtered.fastq.gz
    output: output_coli/LOGS/BBDUK/ODN-E-coli-1_S1_R2_discradingr2seq.log, tmp_coli/ODN-E-coli-1_S1_R2_001filtered_wor1primer.fastq.gz
    log: output_coli/LOGS/discardingr2seq_ODN-E-coli-1_S1.log
    jobid: 5
    benchmark: benchmarks/filteringR1_ODN-E-coli-1_S1.log
    wildcards: stem=ODN-E-coli-1_S1
    threads: 8

bbduk.sh in=tmp_coli/ODN-E-coli-1_S1_R2_001filtered.fastq.gz out=tmp_coli/ODN-E-coli-1_S1_R2_001filtered_wor1primer.fastq.gz ref=datasets/bbmap/R1_rev.fasta threads=8  k=12 hammingdistance=1 restrictleft=40    threads=8 stats=output_coli/LOGS/BBDUK/ODN-E-coli-1_S1_R2_discradingr2seq.log overwrite=t -Xmx4g 2> output_coli/LOGS/discardingr2seq_ODN-E-coli-1_S1.log

[Wed Aug  7 20:01:42 2019]
rule filterout_r1primer_sequence_having_reads:
    input: tmp_coli/ODN-E-coli-1_S1_R1_001filtered.fastq.gz
    output: output_coli/LOGS/BBDUK/ODN-E-coli-1_S1_R1_refiltering.log, tmp_coli/ODN-E-coli-1_S1_R1_001filtered_withr1primer.fastq.gz
    log: output_coli/LOGS/refilteringr1seq_ODN-E-coli-1_S1.log
    jobid: 3
    benchmark: benchmarks/filteringR1_ODN-E-coli-1_S1.log
    wildcards: stem=ODN-E-coli-1_S1
    threads: 8

bbduk.sh in=tmp_coli/ODN-E-coli-1_S1_R1_001filtered.fastq.gz outm=tmp_coli/ODN-E-coli-1_S1_R1_001filtered_withr1primer.fastq.gz ref=datasets/bbmap/R1_rev.fasta threads=8  k=15 restrictleft=40  threads=8 stats=output_coli/LOGS/BBDUK/ODN-E-coli-1_S1_R1_refiltering.log overwrite=t -Xmx4g 2> output_coli/LOGS/refilteringr1seq_ODN-E-coli-1_S1.log
[Wed Aug  7 20:01:43 2019]
Finished job 3.
11 of 19 steps (58%) done
[Wed Aug  7 20:01:43 2019]
Finished job 5.
12 of 19 steps (63%) done

[Wed Aug  7 20:01:43 2019]
rule retrim_R2_adapters_from_primers:
    input: tmp_coli/ODN-E-coli-1_S1_R2_001filtered_wor1primer.fastq.gz
    output: output_coli/LOGS/BBDUK/ODN-E-coli-1_S1_r2retriming.log, tmp_coli/ODN-E-coli-1_S1_R2_001filtered_wor1primer_retrim.fastq.gz
    log: output_coli/LOGS/BBDUK/r2retrimming_ODN-E-coli-1_S1.log
    jobid: 1
    benchmark: benchmarks/trimming_ODN-E-coli-1_S1.log
    wildcards: stem=ODN-E-coli-1_S1
    threads: 8

bbduk.sh in=tmp_coli/ODN-E-coli-1_S1_R2_001filtered_wor1primer.fastq.gz out=tmp_coli/ODN-E-coli-1_S1_R2_001filtered_wor1primer_retrim.fastq.gz ref=datasets/bbmap/R1_rev.fasta threads=8 ktrim=r k=15 mink=7 hdist=1 minlength=100 maxns=1 qtrim=r trimq=15 tpe tbo threads=8 stats=output_coli/LOGS/BBDUK/ODN-E-coli-1_S1_r2retriming.log overwrite=t -Xmx4g 2> output_coli/LOGS/BBDUK/r2retrimming_ODN-E-coli-1_S1.log
[Wed Aug  7 20:01:45 2019]
Finished job 1.
13 of 19 steps (68%) done

[Wed Aug  7 20:01:45 2019]
rule match_pairs_after_filtering:
    input: tmp_coli/ODN-E-coli-1_S1_R1_001filtered_withr1primer.fastq.gz, tmp_coli/ODN-E-coli-1_S1_R2_001filtered_wor1primer_retrim.fastq.gz
    output: tmp_coli/ODN-E-coli-1_S1_R1_001filtered_repaired.fastq.gz, tmp_coli/ODN-E-coli-1_S1_R2_001filtered_repaired.fastq.gz
    log: output_coli/LOGS/rematchingpairs_ODN-E-coli-1_S1.log
    jobid: 2
    benchmark: benchmarks/filteringR1_ODN-E-coli-1_S1.log
    wildcards: stem=ODN-E-coli-1_S1
    threads: 8

repair.sh in=tmp_coli/ODN-E-coli-1_S1_R1_001filtered_withr1primer.fastq.gz out=tmp_coli/ODN-E-coli-1_S1_R1_001filtered_repaired.fastq.gz  in2=tmp_coli/ODN-E-coli-1_S1_R2_001filtered_wor1primer_retrim.fastq.gz out2=tmp_coli/ODN-E-coli-1_S1_R2_001filtered_repaired.fastq.gz threads=8 -Xmx4g &> output_coli/LOGS/rematchingpairs_ODN-E-coli-1_S1.log
[Wed Aug  7 20:01:47 2019]
Finished job 2.
14 of 19 steps (74%) done

[Wed Aug  7 20:01:47 2019]
rule assemble:
    input: tmp_coli/ODN-E-coli-1_S1_R1_001filtered_repaired.fastq.gz, tmp_coli/ODN-E-coli-1_S1_R2_001filtered_repaired.fastq.gz
    output: tmp_coli/ODN-E-coli-1_S1_contigs.fasta, tmp_coli/ODN-E-coli-1_S1.fastg
    jobid: 11
    benchmark: bench_coli/assemble_ODN-E-coli-1_S1.log
    wildcards: stem=ODN-E-coli-1_S1
    threads: 12

rnaspades.py  -1 tmp_coli/ODN-E-coli-1_S1_R1_001filtered_repaired.fastq.gz -2 tmp_coli/ODN-E-coli-1_S1_R2_001filtered_repaired.fastq.gz -t 12 --only-assembler  -o tmp_coli/ODN-E-coli-1_S1_contigs --tmp-dir tmp_coli; cp tmp_coli/ODN-E-coli-1_S1_contigs/transcripts.fasta tmp_coli/ODN-E-coli-1_S1_contigs.fasta; cp tmp_coli/ODN-E-coli-1_S1_contigs/assembly_graph.fastg tmp_coli/ODN-E-coli-1_S1.fastg
[Wed Aug  7 20:04:17 2019]
Finished job 11.
15 of 19 steps (79%) done

[Wed Aug  7 20:04:17 2019]
rule filter_size:
    input: tmp_coli/ODN-E-coli-1_S1_contigs.fasta
    output: tmp_coli/ODN-E-coli-1_S1_contigs_size_filtered.fasta
    jobid: 9
    wildcards: stem=ODN-E-coli-1_S1_contigs

seqkit seq -m 200 -M 12000000000 tmp_coli/ODN-E-coli-1_S1_contigs.fasta > tmp_coli/ODN-E-coli-1_S1_contigs_size_filtered.fasta
[Wed Aug  7 20:04:17 2019]
Finished job 9.
16 of 19 steps (84%) done

[Wed Aug  7 20:04:17 2019]
rule custer:
    input: tmp_coli/ODN-E-coli-1_S1_contigs_size_filtered.fasta
    output: tmp_coli/ODN-E-coli-1_S1_contigs_size_filtered_clustered.fasta
    jobid: 7
    wildcards: stem=ODN-E-coli-1_S1_contigs_size_filtered
    threads: 12

cd-hit-est -T 12 -c 0.95 -i tmp_coli/ODN-E-coli-1_S1_contigs_size_filtered.fasta -o tmp_coli/ODN-E-coli-1_S1_contigs_size_filtered_clustered.fasta 
[Wed Aug  7 20:04:18 2019]
Finished job 7.
17 of 19 steps (89%) done

[Wed Aug  7 20:04:18 2019]
rule detect_rRNA:
    input: tmp_coli/ODN-E-coli-1_S1_contigs_size_filtered_clustered.fasta
    output: tmp_coli/ODN-E-coli-1_S1_contigs_size_filtered_clustered_rRNA.gtf
    log: tmp_coli/ODN-E-coli-1_S1_contigs_size_filtered_clustered_contigs_rRNA.log
    jobid: 4
    wildcards: stem=ODN-E-coli-1_S1_contigs_size_filtered_clustered
    threads: 12

 barrnap --kingdom bac --reject 0.01  --threads 12 tmp_coli/ODN-E-coli-1_S1_contigs_size_filtered_clustered.fasta | grep 16S  > tmp_coli/ODN-E-coli-1_S1_contigs_size_filtered_clustered_rRNA.gtf 2> tmp_coli/ODN-E-coli-1_S1_contigs_size_filtered_clustered_contigs_rRNA.log 
[Wed Aug  7 20:04:21 2019]
Finished job 4.
18 of 19 steps (95%) done

[Wed Aug  7 20:04:21 2019]
localrule all:
    input: tmp_coli/ODN-E-coli-1_S1_contigs_size_filtered_clustered_rRNA.gtf, tmp_coli/ODN-E-coli-1_S1_R1_001filtered_repaired.fastq.gz, tmp_coli/ODN-E-coli-1_S1_R2_001filtered_wor1primer_retrim.fastq.gz, tmp_coli/ODN-E-coli-1_S1_R1_001filtered_withr1primer.fastq.gz
    jobid: 0

[Wed Aug  7 20:04:21 2019]
Finished job 0.
19 of 19 steps (100%) done
Complete log: /media/root/ocean/projects/ga/bracken_ribo_count/.snakemake/log/2019-08-07T200030.701742.snakemake.log
